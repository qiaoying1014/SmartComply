@{
	ViewData["Title"] = "Admin Dashboard";
}

<div class="row" style="min-height: 400px;">
	<!-- Left 50% -->
	<div class="col-12 col-lg-6 mb-4 d-flex flex-column justify-content-between">
	<div class="row flex-grow-1">

		<!-- Card 1: Auditors -->
		<div class="col-6 mb-3 d-flex">
			<div class="card flex-fill">
				<div class="card-body d-flex flex-column justify-content-center">
					<div class="d-flex justify-content-between align-items-center mb-2">
						<h5 class="mb-0">Users (Auditors)</h5>
						<img src="~/img/icons/unicons/user.png" class="rounded" width="24" />
					</div>
					<div class="d-flex justify-content-center align-items-center flex-grow-1">
						<div id="auditorCountLoader" class="spinner-border text-primary" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
						<h4 class="card-title text-center fw-bold mb-0 ms-3" style="font-size: 4rem; color: #7367F0; display: none;" id="auditorCount">0</h4>
					</div>
				</div>
			</div>
		</div>

		<!-- Card 2: Managers -->
		<div class="col-6 mb-3 d-flex">
			<div class="card flex-fill">
				<div class="card-body d-flex flex-column justify-content-center">
					<div class="d-flex justify-content-between align-items-center mb-2">
						<h5 class="mb-0">Managers</h5>
						<img src="~/img/icons/unicons/manager.png" class="rounded" width="24" />
					</div>
					<div class="d-flex justify-content-center align-items-center flex-grow-1">
						<div id="managerCountLoader" class="spinner-border text-primary" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
						<h4 class="card-title text-center fw-bold mb-0 ms-3" style="font-size: 4rem; color: #7367F0; display: none;" id="managerCount">0</h4>
					</div>
				</div>
			</div>
		</div>

		<!-- Card 3: Active Branches -->
		<div class="col-6 d-flex">
			<div class="card flex-fill">
				<div class="card-body d-flex flex-column justify-content-center">
					<div class="d-flex justify-content-between align-items-center mb-2">
						<h5 class="mb-0">Branches</h5>
						<img src="~/img/icons/unicons/building.png" class="rounded" width="24" />
					</div>
					<div class="d-flex justify-content-center align-items-center flex-grow-1">
						<div id="branchCountLoader" class="spinner-border text-primary" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
						<h4 class="card-title text-center fw-bold mb-0 ms-3" style="font-size: 4rem; color: #7367F0; display: none;" id="branchCount">0</h4>
					</div>
				</div>
			</div>
		</div>

		<!-- Card 4: Enabled Categories -->
		<div class="col-6 d-flex">
			<div class="card flex-fill">
				<div class="card-body d-flex flex-column justify-content-center">
					<div class="d-flex justify-content-between align-items-center mb-2">
						<h5 class="mb-0">Compliance Categories</h5>
						<img src="~/img/icons/unicons/folder.png" class="rounded" width="24" />
					</div>
					<div class="d-flex justify-content-center align-items-center flex-grow-1">
						<div id="categoryCountLoader" class="spinner-border text-primary" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
						<h4 class="card-title text-center fw-bold mb-0 ms-3" style="font-size: 4rem; color: #7367F0; display: none;" id="categoryCount">0</h4>
					</div>
				</div>
			</div>
		</div>
	</div>
	</div>

	<!-- Right 50%: Pie chart -->
	<div class="col-12 col-lg-6 mb-4 d-flex">
		<div class="card flex-fill">
			<div class="card-header d-flex justify-content-between align-items-center">
				<h5 class="mb-0">Forms by Compliance Category</h5>
			</div>
			<div class="text-center my-4" id="pieLoader">
				<div class="spinner-border text-primary" role="status">
					<span class="visually-hidden">Loading...</span>
				</div>
			</div>
			<div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
				<canvas id="formPieChart" style="max-width: 400px; max-height: 400px;"></canvas>
			</div>
		</div>
	</div>
</div>

@section Scripts {
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script>
			async function loadDashboardData() {
				const res = await fetch('/AdminDashboard/GetDashboardData');
				const data = await res.json();

				document.getElementById('auditorCount').textContent = data.auditorsCount;
				document.getElementById('auditorCountLoader').style.display = 'none';
				document.getElementById('auditorCount').style.display = 'inline';

				document.getElementById('managerCount').textContent = data.managersCount;
				document.getElementById('managerCountLoader').style.display = 'none';
				document.getElementById('managerCount').style.display = 'inline';

				document.getElementById('branchCount').textContent = data.activeBranches;
				document.getElementById('branchCountLoader').style.display = 'none';
				document.getElementById('branchCount').style.display = 'inline';

				document.getElementById('categoryCount').textContent = data.enabledCategories;
				document.getElementById('categoryCountLoader').style.display = 'none';
				document.getElementById('categoryCount').style.display = 'inline';
			}

			async function loadFormPieChart() {
				const res = await fetch('/AdminDashboard/GetFormDistribution');
				const data = await res.json();

				const ctx = document.getElementById('formPieChart').getContext('2d');
				new Chart(ctx, {
					type: 'pie',
					data: {
						labels: data.map(d => d.category),
						datasets: [{
							data: data.map(d => d.count),
								backgroundColor: [
									'#7367F0', '#28C76F', '#FF9F43', '#EA5455', '#00cfe8', 
									'#1E90FF', '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
									'#9966FF', '#FF6F61', '#6B5B95', '#88B04B', '#F7CAC9',
									'#92A8D1', '#955251', '#B565A7', '#009B77', '#DD4124',
									'#2A9D8F', '#F4A261', '#E76F51', '#3D348B', '#F1C40F',
									'#27AE60', '#8E44AD', '#D35400', '#C0392B', '#2980B9'
								]
						}]
					},
					options: {
						responsive: true,
						plugins: {
							legend: {
								position: 'bottom'
							}
						}
					}
				});
				document.getElementById("pieLoader").style.display = "none";
			}

			document.addEventListener('DOMContentLoaded', () => {
				loadDashboardData();
				loadFormPieChart();
			});
		</script>
}
